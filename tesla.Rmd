---
title: "TESLA"
author: "Jianling Hu"
date: '2022-05-04'
output: html_document
---

```{r}
getwd() 
setwd("/Users/jianlinghu/Documents/Analytics/Spring 2022/MSCA 31006 2 Time Series Analysis and Forecasting/group work")
```

## Read data and plot the trends of "closing price" over time

```{r}
data<-read.csv("TSLA (1).csv",header = T,stringsAsFactors = F)
data<-data[,c(1,5)]
```

## Note: x-axis "Time" is in days, the range should be [0, 2978]

```{r}
plot(data$Close,type="l",xlab="Time",ylab="Closing Price",main="TESLA TS")
```

## More plots with details (observed, seasonality, random)

## Note: Seasonality defined as 252 days (approx. number of days that use 365 days deduct weekends for NASDAQ)

```{r}
close<-ts(data$Close,frequency = 252)
de<-decompose(close)
plot(de)
```


## TS plots of "closing price" over time; 

## Zoom in the plots of the obvious fluctuations starts from row number 2401 (the date is 2020/1/8);

```{r}
library(xts)
close <- xts(x = data$Close,as.Date(data$Date,format='%Y-%m-%d'),frequency = 252)
plot(close)
plot(close[2401:2978])
```
## Analysis of Stationarity

```{r}
library(tseries)
adf.test(close)
diff_close<-diff(close)
adf.test(diff_close[-1])
```

## model: use the last 252 days as our "out of sample forecast", the rest of the data is our sample that used for forecasting

```{r}
n<-length(close)
library(forecast)

model <- ets(close[(1:(n-252))])

summary(model)
```

```{r}
pred<-forecast(model,h=252)$mean 
error<-pred-close[2727:n]
mse<-mean(error^2)
mae<-mean(abs(error))
mape<-mean(abs(error/close[2727:n]))
rmse<-sqrt(mean((error)^2))
rmspe<-sqrt(mean((error/close[2727:n])^2))

mse
mae
mape
rmse
rmspe
```

## model 1: Exponential Smoothing (ETS)

```{r}
foreca<-array(NA,dim = c(252,1))
for (i in 1:252) {
  model<-ets(close[1:(2725+i)])
  foreca[i,1]<-forecast(model,h=1)$mean
}
error1<-foreca-close[2727:n]
mse1<-mean(error1^2)
mae1<-mean(abs(error1))
mape1<-mean(abs(error1/close[2727:n]))
rmse1<-sqrt(mean((error1)^2))
rmspe1<-sqrt(mean((error1/close[2727:n])^2))

mse1
mae1
mape1
rmse1
rmspe1
```


## model 2 : Naive Model

```{r}
foreca1<-array(NA,dim = c(252,1))
for (i in 1:252) {
  foreca1[i,1]<-snaive(close[1:(2725+i)],h=1)$mean
}
error2<-foreca1-close[2727:n]
mse2<-mean(error2^2)
mae2<-mean(abs(error2))
mape2<-mean(abs(error2/close[2727:n]))
rmse2<-sqrt(mean((error2)^2))
rmspe2<-sqrt(mean((error2/close[2727:n])^2))

mse2
mae2
mape2
rmse2
rmspe2
```


## model 3: ARIMA

```{r}
foreca2<-array(NA,dim = c(252,1))
for (i in 1:252) {
  model<-auto.arima(close[1:(2725+i)])
  foreca2[i,1]<-forecast(model,h=1)$mean
}

error3<-foreca2-close[2727:n]
mse3<-mean(error3^2)
mae3<-mean(abs(error3))
mape3<-mean(abs(error3/close[2727:n]))
rmse3<-sqrt(mean((error3)^2))
rmspe3<-sqrt(mean((error3/close[2727:n])^2))

mse3
mae3
mape3
rmse3
rmspe3
```


## Outcome comparisons for 4 models above

```{r}
performance_values= matrix(c(64813.8, 1068.173, 1062.462, 1176.98, 216.41, 22.53, 22.5, 24.5, 0.301, 0.025, 0.025, 0.0275, 254.59, 32.68, 32.59, 34.307, 0.375, 0.0349, 0.035, 0.036), ncol=4, byrow=TRUE)
 
colnames(performance_values) = c('Sample Forecast','     Exponential Smoothing','    Naive Model','       ARIMA  ')
rownames(performance_values) <- c('MSE  ','MAE  ','MAPE  ','RMSE  ','RMSPE  ')
 
performance_table = as.table(performance_values)
 
performance_table
```

